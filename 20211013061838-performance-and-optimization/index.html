<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.0">
     
     
    <link rel="icon" type="image/png" sizes="192x192" href="../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png" />


    
 
<title>Performance & Optimization - notes</title>


<link href="../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../css/normalize.css" rel="stylesheet">
<link href="../css/terminal.css" rel="stylesheet">
<link href="../css/theme.css" rel="stylesheet">
<link href="../css/theme.tile_grid.css" rel="stylesheet">
<link href="../css/theme.footer.css" rel="stylesheet">
<!-- dark color palette -->
<link href="../css/palettes/dark.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}</style>



     
    
    

    
    <!-- search css support -->
<link href="../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "..",
    shortcuts = "{}";
</script>
<script src="../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="/" class="no-style">notes</a></div>
        </header>
        
        <nav class="terminal-menu">
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#performance-optimization">Performance &amp; Optimization</a></li>
        <li><a href="#resources">Resources</a></li><li><a href="#notes">Notes</a></li>
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
    
    
    
    
    

<section id="mkdocs-terminal-content">
    <h1 id="performance-optimization">Performance &amp; Optimization<a class="headerlink" href="#performance-optimization" title="Anchor link to this section for reference">#</a></h1>
<h2 id="resources">Resources<a class="headerlink" href="#resources" title="Anchor link to this section for reference">#</a></h2>
<ul>
<li><a href="https://www.brendangregg.com/blog/2017-08-08/linux-load-averages.html">Explanation of what load averages really means</a></li>
<li><a href="https://medium.com/netflix-techblog/linux-performance-analysis-in-60-000-milliseconds-accc10403c55">Commands you should run in the first 60 seconds on a misbehaving server</a></li>
<li><a href="https://medium.com/netflix-techblog/netflix-at-velocity-2015-linux-performance-tools-51964ddb81cf">In-depth analysis of Linux Performance tools</a></li>
<li><a href="https://www.cyberciti.biz/tips/top-linux-monitoring-tools.html">30 Linux monitoring tools every sysadmin should know</a></li>
</ul>
<h2 id="notes">Notes<a class="headerlink" href="#notes" title="Anchor link to this section for reference">#</a></h2>
<ul>
<li><a href="https://medium.com/netflix-techblog/netflix-at-velocity-2015-linux-performance-tools-51964ddb81cf">Source</a></li>
<li><a href="https://www.slideshare.net/brendangregg/velocity-2015-linux-perf-tools">Slides from presentation</a></li>
</ul>
<p>It's important to have a methodology. I've run these tools in this manner and I
didn't find anything that indicates a performance issue on the server. I think
you should check your code.</p>
<h3 id="anti-methods">Anti-Methods<a class="headerlink" href="#anti-methods" title="Anchor link to this section for reference">#</a></h3>
<p>Drunk man looking for their keys under a streetlamp because that's where the
light is.</p>
<p>Blame someone else anti-method.</p>
<h3 id="actual-methodologies">Actual Methodologies<a class="headerlink" href="#actual-methodologies" title="Anchor link to this section for reference">#</a></h3>
<ul>
<li>Problem statement</li>
<li>Workload characterization</li>
<li>USE</li>
<li>Off-CPU Analysis</li>
<li>CPU profile</li>
<li>RTFM Method</li>
<li>Active Benchmarking</li>
<li>Static Performance Tuning</li>
</ul>
<h4 id="problem-statement-method">Problem Statement Method<a class="headerlink" href="#problem-statement-method" title="Anchor link to this section for reference">#</a></h4>
<ol>
<li>What makes you <strong>think</strong> there is a performance problem?</li>
<li>Has this system <strong>ever</strong> performed well?</li>
<li>What has <strong>changed</strong> recently?
  a. Software?
  b. Hardware? 
  c. Load?</li>
<li>Can the performance degradation be expressed in terms of <strong>latency</strong> or run
   time?</li>
<li>Does the problem affect <strong>other</strong> people or applications (or is it just you)?</li>
<li>What is the <strong>environment</strong>? Software, hardware, instance types? Versions?
   Configuration?</li>
</ol>
<h4 id="workload-characterization-method">Workload Characterization Method<a class="headerlink" href="#workload-characterization-method" title="Anchor link to this section for reference">#</a></h4>
<ol>
<li><strong>Who</strong> is causing the load? PID, UID, IP addr, ...</li>
<li><strong>Why</strong> is the load called? code path, stack trace</li>
<li><strong>What</strong> is the load? IOPS, tput, type, r/w</li>
<li><strong>How</strong> is the load changing over time?</li>
</ol>
<h4 id="the-use-method">The USE Method<a class="headerlink" href="#the-use-method" title="Anchor link to this section for reference">#</a></h4>
<p>Only check these 3 things for all of your resources.</p>
<p>For every resource check:</p>
<ol>
<li>Utilization</li>
<li>Saturation</li>
<li>Errors</li>
</ol>
<p>Definitions:</p>
<ul>
<li>Utilization: busy time</li>
<li>Saturation: queue length or queued time</li>
<li>Errors: easy to interpret (objective)</li>
</ul>
<p>It helps if you have a functional (block) diagram of your system / software /
environment, showing all resources</p>
<p>Start with questions, then find the tools.</p>
<h5 id="use-method-linux-performance-checklist">USE Method: Linux Performance Checklist<a class="headerlink" href="#use-method-linux-performance-checklist" title="Anchor link to this section for reference">#</a></h5>
<p><a href="https://www.brendangregg.com/USEmethod/use-linux.html">USE Linux</a></p>
<h4 id="off-cpu-analysis">Off-CPU Analysis<a class="headerlink" href="#off-cpu-analysis" title="Anchor link to this section for reference">#</a></h4>
<p><em>See slides</em></p>
<p>I'm not sure I understand this really...worth more research.</p>
<h4 id="cpu-profile-method">CPU Profile Method<a class="headerlink" href="#cpu-profile-method" title="Anchor link to this section for reference">#</a></h4>
<ol>
<li>Take a CPU profile</li>
<li>
<p>Understand all software in profile &gt; 1%</p>
</li>
<li>
<p>Discovers a wide range of performance issues by their CPU usage.</p>
</li>
<li>Narrows software study.</li>
</ol>
<p>If you profile what's on CPU then narrows down what parts of the software (i.e.
MySQL) is actually turned on and therefore needs to be looked at.</p>
<h4 id="rtfm">RTFM<a class="headerlink" href="#rtfm" title="Anchor link to this section for reference">#</a></h4>
<p>How to understand performance tools or metrics?</p>
<ol>
<li>Man pages</li>
<li>Books</li>
<li>Web search</li>
<li>Co-workers</li>
<li>Talks, slides, videos</li>
<li>Support services</li>
<li>Source code</li>
<li>Experimentation</li>
<li>Social</li>
</ol>
<p>Reading through source code. Writing a bit of code that should tax the resource
in the way we're looking for.</p>
<h3 id="tools">Tools<a class="headerlink" href="#tools" title="Anchor link to this section for reference">#</a></h3>
<p>Objectives:</p>
<ul>
<li>Perform the USE Method for resource utilization</li>
<li>Perform workload characterization for disks, network</li>
<li>Perform CPU Profile Method using flame graphs</li>
<li>Have exposure to various observability tools:</li>
<li>Basic: vmstat, iostat, mpstat, ps, top</li>
<li>Intermediate: tcpdump, netstat, nicstat, pidstat, sar,</li>
<li>Advnaced: ss, slaptop, perf_events, </li>
<li>Perform Active Benchmarking</li>
<li>Understand tuning risks</li>
<li>Perform Static Performance Tuning</li>
</ul>
<h4 id="tool-types">Tool Types<a class="headerlink" href="#tool-types" title="Anchor link to this section for reference">#</a></h4>
<table>
<thead>
<tr>
<th>Type</th>
<th>Types</th>
</tr>
</thead>
<tbody>
<tr>
<td>Observability</td>
<td>Watch activity. Safe: usually, depending on resource overhead.</td>
</tr>
<tr>
<td>Benchmarking</td>
<td>Load test. Caution: production tests can cause issues due to contention.</td>
</tr>
<tr>
<td>Tuning</td>
<td>Change. Danger: changes could hurt performance, now or later with load.</td>
</tr>
<tr>
<td>Static</td>
<td>Check configuration. Should be safe.</td>
</tr>
</tbody>
</table>
<h4 id="basic-observability-tools">Basic Observability Tools<a class="headerlink" href="#basic-observability-tools" title="Anchor link to this section for reference">#</a></h4>
<ul>
<li>uptime</li>
<li>top or htop</li>
<li>ps</li>
<li>vmstat</li>
<li>iostat</li>
<li>mpstat</li>
<li>free</li>
</ul>
<h4 id="intermediate-observability-tools">Intermediate Observability Tools<a class="headerlink" href="#intermediate-observability-tools" title="Anchor link to this section for reference">#</a></h4>
<ul>
<li>strace</li>
<li>tcpdump</li>
<li>netstat</li>
<li>nicstat</li>
<li>pidstat</li>
<li>swapon</li>
<li>lsof</li>
<li>sar - System Activity Reporter</li>
</ul>
</section>

<section id="mkdocs-terminal-after-content">
    
</section>

            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>